<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Text ‚Üî Image Encryption</title>

    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 25px;
        }

        h2 {
            text-align: center;
            margin-bottom: 5px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 18px;
            font-size: 14px;
        }

        .container {
            max-width: 1100px;
            margin: auto;
        }

        .passcode-box {
            max-width: 450px;
            margin: 0 auto 18px;
            background: #fff;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .passcode-box label {
            font-weight: bold;
        }

        .passcode-box p {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .panels {
            display: flex;
            gap: 22px;
        }

        .panel {
            flex: 1;
            background: #fff;
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
        }

        .panel h3 {
            text-align: center;
            margin-bottom: 12px;
            color: #007BFF;
        }

        label {
            font-weight: bold;
            margin-top: 8px;
            font-size: 14px;
        }

        textarea {
            width: 100%;
            height: 180px;
            padding: 10px;
            font-size: 14px;
            resize: vertical;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        input, button {
            padding: 9px;
            font-size: 14px;
            border-radius: 6px;
            margin-top: 6px;
        }

        input {
            border: 1px solid #ccc;
        }

        button {
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 12px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .image-preview {
            width: 100%;
            height: 240px;
            border: 1px dashed #bbb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            margin-top: 8px;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }

        .download-btn {
            text-decoration: none;
            text-align: center;
            padding: 9px;
            font-size: 14px;
            background-color: #28a745;
            color: white;
            border-radius: 6px;
            margin-top: 8px;
            display: none;
        }

        .download-btn:hover {
            background-color: #1e7e34;
        }

        .action-note {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
            text-align: center;
        }
    </style>
</head>

<body>
<div class="container">

    <h2>Encrypt / Decrypt Text ‚Üî Image</h2>
    <div class="subtitle">
        Secure text using autogenerated coloured images and retrieve it using the same passcode
    </div>

    <!-- PASSCODE -->
    <div class="passcode-box">
        <label>Passcode (for both Encrypt & Decrypt)</label>
        <input type="password" id="passcodeInput" placeholder="Enter secret passcode">
        <p>For security, the passcode is cleared after each operation.</p>
    </div>

    <div class="panels">

        <!-- TEXT TO IMAGE -->
        <div class="panel">
            <h3>üîê Text ‚Üí Image (Encrypt)</h3>

            <label>Text Input</label>
            <textarea id="textInput" placeholder="Type text to encrypt..."></textarea>

            <button id="textToImageBtn">Encrypt & Generate Image</button>

            <div class="action-note">
                Converts text into a secure coloured image
            </div>
        </div>

        <!-- IMAGE TO TEXT -->
        <div class="panel">
            <h3>üîì Image ‚Üí Text (Decrypt)</h3>

            <label>Select Encrypted Image</label>
            <input type="file" id="imageInput" accept="image/*">

            <div class="image-preview">
                <img id="resultImage" src="#" alt="Encrypted Image Preview">
            </div>

            <button id="imageToTextBtn">Decrypt Image</button>

            <a id="downloadBtn" class="download-btn" href="#" download="encrypted-image.png">
                Download Encrypted Image
            </a>

            <div class="action-note">
                Upload encrypted image to retrieve hidden text
            </div>
        </div>

    </div>
</div>

<script>
    const textInput = document.getElementById('textInput');
    const imageInput = document.getElementById('imageInput');
    const resultImage = document.getElementById('resultImage');
    const downloadBtn = document.getElementById('downloadBtn');
    const passcodeInput = document.getElementById('passcodeInput');

    const textToImageBtn = document.getElementById('textToImageBtn');
    const imageToTextBtn = document.getElementById('imageToTextBtn');

    /* ---------- ENCRYPT ---------- */
    textToImageBtn.addEventListener('click', () => {
        const text = textInput.value;
        const passcode = passcodeInput.value;
        const file = imageInput.files[0];

        if (!text) { alert("Enter text to encrypt"); return; }
        if (!passcode) { alert("Enter a passcode"); return; }

        const formData = new FormData();
        formData.append("text", text);
        formData.append("passcode", passcode);
        if (file) formData.append("image", file);

        fetch('/encrypt', { method: 'POST', body: formData })
            .then(res => { if (!res.ok) throw new Error("Server error"); return res.blob(); })
            .then(blob => {
                const url = URL.createObjectURL(blob);
                resultImage.src = url;
                resultImage.style.display = 'block';
                downloadBtn.href = url;
                downloadBtn.style.display = 'block';

                passcodeInput.value = ""; // ‚úÖ clear passcode
            })
            .catch(err => alert("Error: " + err));
    });

    /* ---------- DECRYPT ---------- */
    imageToTextBtn.addEventListener('click', () => {
        const file = imageInput.files[0];
        const passcode = passcodeInput.value;

        if (!file) { alert("Choose an image first"); return; }
        if (!passcode) { alert("Enter the passcode"); return; }

        const formData = new FormData();
        formData.append("image", file);
        formData.append("passcode", passcode);

        fetch('/decrypt', { method: 'POST', body: formData })
            .then(res => { if (!res.ok) throw new Error("Server error"); return res.text(); })
            .then(text => {
                textInput.value = text;
                passcodeInput.value = ""; // ‚úÖ clear passcode
            })
            .catch(err => alert("Error: " + err));
    });
</script>
</body>
</html>
